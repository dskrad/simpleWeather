<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
  <head>            
    <title>David's Local Weather</title>
    <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <div id="weather"></div>
    <div id="clock"></div>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="jquery.simpleWeather.js"></script>
    <script>
      $(document).ready(function() {
        setInterval(getWeather, 600000); //update every 10 minutes
        setInterval(showClock, 500);
      });
      
      function getWeather() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(success, geoError);
          } else {
            alert("Geolocation not supported") ;
        }
      };
      
      function success(position) {
        var url = "https://forecast.weather.gov/MapClick.php?lat=" + position.coords.latitude
                + "&lon=" + position.coords.longitude + "&FcstType=json"
        $.getJSON(url, function(json) {
          var temp = json.currentobservation.Temp;
          var dewp = json.currentobservation.Dewp;
          var hum = json.currentobservation.Relh;
          var location = json.location.areaDescription;
          html = '<h2>'+temp+'&deg;F </h2>';
          html += '<ul><li>'+dewp+'&deg;F </li>';
          html += '<li>'+hum+'%</li>'
          html += '<li>'+location+'</li></ul>';
          //html += '<li class="currently">'+weather.currently+'</li>';
          //html += '<li>'+weather.alt.temp+'&deg;C</li></ul>';
            
          $("#weather").html(html);
        }); 
      };
      
      function showClock() {
        var today = new Date();
        var h = today.getHours();
        var m = today.getMinutes();
        if (m < 10) {m = "0" + m};  // add zero in front of numbers < 10
        $("#clock").html(h + ":" + m);
      };
      
      function geoError(error) {
        alert("code: " + error.code + " msg: " + error.message);
      };
     
    </script>
  </body>
</html>

